pkgname=cinelerra-heroine
pkgver=4.2
pkgrel=7
pkgdesc="Cinelerra from the HeroineWarrior.com website (64-bit)."
arch=('x86_64')
url="http://www.heroinewarrior.com/cinelerra.php"
license=('GPL')
depends=('e2fsprogs' 'a52dec' 'fftw' 'lame' 'libavc1394' 'libiec61883'
	 'libraw1394' 'libsndfile' 'libvorbis' 'libogg' 'libpng>=1.4.0'
	 'libjpeg>=8' 'libtiff' 'esound' 'mjpegtools' 'openexr' 'x264'
	 'libxxf86vm' 'ffmpeg' 'libxv' 'faad2' 'faac' 'libtheora'
	 'freetype2' 'libquicktime' 'doxygen')
makedepends=('yasm' 'nasm' 'libtool')
conflicts=('cinelerra-cv')
install=create_link.install
source=(https://sourceforge.net/projects/heroines/files/cinelerra-$pkgver-src.tar.bz2
	gcc43.patch
	cinelerra-heroine-v4l1_removal2.patch
	configure.patch
	create_link.install)
md5sums=('b1f2b50dbd96790ef99d638b95ee7959'
	 '7c83ee3d69ad688142e7de63cb68e70a'
	 '38c14c7f33449c029c63e44de484a0ac'
	 'd466eed973106f1011400ac5488573a9'
	 '84af3252946dde6e42b9bdee81571e07') 

build() {
  cd "${srcdir}/cinelerra-$pkgver/thirdparty/openexr-1.6.1"
  #apply a GCC patch thing?
  #patch -p1 -i ${srcdir}/gcc43.patch
  cd "${srcdir}/cinelerra-$pkgver"
  #make it compile with kernel >=2.6.38
  patch -p1 -i ${srcdir}/cinelerra-heroine-v4l1_removal2.patch
  #disable shared objects (otherwise it won't compile)
  patch configure ${srcdir}/configure.patch
  #fix crashing problems (taken from: https://bbs.archlinux.org/viewtopic.php?id=100668)
  sed -i "s/include <mp4.h>/include <mp4v2\/mp4v2.h>/g" "quicktime/thirdparty/faac-1.24/frontend/main.c"
  ./configure
  make
  make install

  rm -rf ${pkgdir}/usr/lib/cinelerra/
  mkdir -p ${pkgdir}/usr/lib/cinelerra/
  mv bin/* ${pkgdir}/usr/lib/cinelerra/
}
