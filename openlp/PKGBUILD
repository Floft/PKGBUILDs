# Maintainer: Garrett <floft.net/contact>
pkgname=openlp
pkgver=1.9.7
pkgrel=2
pkgdesc="Church presentation software."
arch=('any')
url='http://openlp.org/'
license=('GPLv2')
depends=('qt' 'python2' 'python2-pyqt' 'python2-distribute' 'phonon' 'python2-chardet'
	'python-lxml' 'python-beautifulsoup' 'python2-sqlalchemy' 'python2-sip'
	'python-pysqlite-legacy' 'python2-pyenchant' 'python-mako' 'python2-migrate')
optdepends=('libreoffice-impress: display impress presentations')
install=openlp.install
source=(http://sourceforge.net/projects/${pkgname}/files/${pkgname}/${pkgver}/OpenLP-${pkgver}.tar.gz openlp.sh)
md5sums=('b38dec890830eb2d55cbfd5d16168dca'
	 'bb78637dd085de567dc8aea8699939bf')
sha256sums=('05e30c106c056552ef4c34af617cefc027dfe219c23c6f7663415c5ac4642bd4'
	    'c85060eeb512410b8b9b9a3a638c70006f45ded0e4b551fc7135fdcd2ff915d5')

build() {
  #openlp
  cd "${srcdir}/OpenLP-${pkgver}"
  python2 setup.py install --root="${pkgdir}/" --optimize=1
  mv "${pkgdir}/usr/bin/openlp"{.pyw,}
  #change version
  echo "${pkgver}" > "${pkgdir}/usr/lib/python2.7/site-packages/openlp/.version"
  #make impress work
  install -Dm755 "${srcdir}/openlp.sh" "${pkgdir}/etc/profile.d/openlp.sh"
  #desktop file
  install -D "resources/openlp.desktop" "${pkgdir}/usr/share/applications/openlp.desktop"
  #translations
  tsrcdir="${srcdir}/OpenLP-${pkgver}/resources/i18n"
  tdestdir="${pkgdir}/usr/share/${pkgname}/i18n"
  mkdir -p "${tdestdir}"
  cd "${tsrcdir}"
  
  for file in *.ts; do
    lconvert -i "${file}" -o "${tdestdir}/${file%%ts}qm"
  done
}
