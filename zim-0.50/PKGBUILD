# Contributor: Kevin Piche <kevin@archlinux.org>
# Maintainer: Daniel J Griffiths <ghost1227@archlinux.us>

pkgname=zim
pkgver=0.50
pkgrel=1
pkgdesc="A WYSIWYG text editor that aims at bringing the concept of a wiki to the desktop."
arch=(any)
license=('GPL' 'PerlArtistic')
url="http://zim-wiki.org/"
depends=('pygtk' 'ttf-dejavu')
optdepends=('bzr: Version Control plugin'
	    'graphviz: Insert Diagram & Link Map plugins'
	    'gtkspell: Spell Checker plugin'
	    'scrot: Insert Screenshot plugin'
	    'texlive-bin: Insert Equation plugin')
install=zim.install
source=(http://www.zim-wiki.org/downloads/${pkgname}-${pkgver}.tar.gz fix-export-assert.patch fix-br-xhtml.patch)
md5sums=('1d0245755f6c814d0c7423ae5e8e958c' 'db22c9fe846616e74941e6d0a64424e7' '22225fd87e0cf3c352ebeac146e74712')

build() {
	cd ${srcdir}/${pkgname}-${pkgver}

    # python2 fixes
    for file in zim/_lib/xdot.py zim/_version.py; do
        sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' $file
    done

	sed -i 's|\t\tinstall_class.run(self)|&\n\t\treturn None|' setup.py
}

package() {
	cd ${srcdir}/${pkgname}-${pkgver}

	python2 setup.py install --root=${pkgdir} --optimize=1
	#my patch
	cd $pkgdir/usr/lib/python*/site-packages/zim/
	patch -p6 < $srcdir/fix-export-assert.patch
	patch -p6 < $srcdir/fix-br-xhtml.patch
}
